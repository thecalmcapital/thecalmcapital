<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Calm Capital | Institutional Wealth Preservation Strategy for India</title>
    <meta name="description" content="A comprehensive institutional guide to long-term wealth preservation for Indian investors. Mastering asset allocation, inflation hedging, and risk management." />
    <meta name="theme-color" content="#0a0a0a" />
    
    <!-- SEO: JSON-LD Structured Data for Sitelinks -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "The Calm Capital",
      "url": "https://thecalmcapital.github.io/",
      "description": "Institutional-grade financial knowledge hub.",
      "hasPart": [
        {
          "@type": "WebPage",
          "name": "Inflation & Purchasing Power",
          "description": "Understanding the silent erosion of capital.",
          "url": "https://thecalmcapital.github.io/#inflation"
        },
        {
          "@type": "WebPage",
          "name": "Structural Asset Classes",
          "description": "The building blocks of a portfolio.",
          "url": "https://thecalmcapital.github.io/#asset-classes"
        },
        {
          "@type": "WebPage",
          "name": "The Art of Subtraction",
          "description": "Via Negativa in Capital Allocation.",
          "url": "https://thecalmcapital.github.io/#subtraction"
        }
      ]
    }
    </script>

    <!-- Resource Hints -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://esm.sh" crossorigin>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Critical CSS -->
    <style>
      :root {
        --bg: #0a0a0a;
        --card: #121212;
        --border: #2a2a2a;
        --text: #E5E5E5;
        --gold: #D4AF37;
        --gold-dim: #8a7020;
      }
      body { 
        background-color: var(--bg);
        background-image: radial-gradient(circle at 50% 0%, #1c1800 0%, #0a0a0a 60%);
        background-attachment: fixed;
        color: var(--text); 
        margin: 0;
        font-family: 'Inter', sans-serif;
        overflow-x: hidden;
      }
      
      .text-gold { color: var(--gold) !important; }
      .border-gold { border-color: var(--gold) !important; }
      .bg-gold { background-color: var(--gold) !important; }
      
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: var(--bg); }
      ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 4px; }
      ::selection { background: rgba(212, 175, 55, 0.3); color: var(--gold); }

      .chapter-section, .asset-grid-container {
        content-visibility: auto;
        contain-intrinsic-size: 1px 500px;
      }

      /* Skeleton Loader */
      .sk-container { display: flex; min-height: 100vh; background: transparent; }
      .sk-sidebar { display: none; width: 320px; border-right: 1px solid rgba(212, 175, 55, 0.4); padding: 2rem; box-sizing: border-box; }
      .sk-main { flex: 1; padding: 1.5rem; width: 100%; max-width: 900px; margin: 0 auto; box-sizing: border-box; }
      .sk-block { background-color: var(--card); border-radius: 4px; margin-bottom: 1rem; border: 1px solid rgba(212, 175, 55, 0.2); }
      .sk-pulse { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
      .sk-sidebar { border-top: 4px solid var(--gold); } 

      @media (min-width: 1024px) {
        .sk-sidebar { display: flex; flex-direction: column; position: fixed; height: 100vh; top: 0; left: 0; }
        .sk-main { padding: 6rem; padding-left: 340px; }
      }

      @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .4; } }
    </style>

    <!-- Import Map -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client?deps=react@18.2.0",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0",
        "framer-motion": "https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0"
      }
    }
    </script>
</head>
<body>
    <div id="root">
      <div class="sk-container">
        <nav class="sk-sidebar" style="border-right: 1px solid rgba(212, 175, 55, 0.4);">
           <div class="sk-block" style="height: 40px; width: 140px; margin-bottom: 0.5rem; background: transparent; border: none;">
             <div style="height: 4px; width: 40px; background: var(--gold); margin-bottom: 10px;"></div>
           </div>
           <div class="sk-block" style="height: 20px; width: 120px; margin-bottom: 3rem; opacity: 0.5; border: none;"></div>
           <div class="sk-block sk-pulse" style="height: 40px; width: 100%;"></div>
           <div class="sk-block sk-pulse" style="height: 40px; width: 100%;"></div>
           <div class="sk-block sk-pulse" style="height: 40px; width: 100%;"></div>
        </nav>
        <main class="sk-main">
           <div class="sk-block sk-pulse" style="height: 60px; width: 90%; margin-bottom: 1rem; border: none;"></div>
           <div class="sk-block sk-pulse" style="height: 300px; width: 100%; margin-bottom: 4rem; border: 1px solid rgba(212, 175, 55, 0.3); border-left: 2px solid var(--gold); background: transparent;"></div>
        </main>
      </div>
    </div>

    <!-- 1. Content Data -->
    <script>
      window.CALM_CAPITAL_CONTENT = [
  {
    id: 'home',
    title: 'The Calm Capital',
    subtitle: 'Institutional Wealth Preservation Strategy for India',
    icon: 'Compass',
    layout: 'hub',
    readTime: "Start Here",
    content: {
      openingContext: "The trajectory of the Indian economy is widely regarded as one of the most compelling growth stories of the 21st century. However, a profound disconnect exists between the nation's macroeconomic success and the financial outcomes of the average household. The Calm Capital exists to bridge this gap through structural understanding, not speculation.",
      visualType: 'dilemma',
      chapters: [], 
      behavioralDimension: "",
      limitations: [],
      riskStatement: "",
      source: ""
    }
  },
  {
    id: 'inflation',
    title: 'Inflation & Purchasing Power',
    subtitle: 'The Silent Erosion of Capital',
    icon: 'Scale',
    readTime: "22 min read",
    content: {
      openingContext: "In the architecture of modern economics, inflation is not merely a statistic; it is a structural inevitability. It represents the persistent, non-linear decline in the purchasing power of fiat currency. For the prudent investor, understanding inflation is the first step in capital preservation. It is the invisible adversary that transforms safe 'saving' into guaranteed loss.",
      visualType: 'inflation',
      chapters: [
        { 
            heading: "I. The Mechanics of Currency Devaluation", 
            body: `Inflation acts as a dynamic tax on idle capital. In an economy targeting a 4-6% inflation rate (RBI's mandate), cash held in non-interest-bearing accounts effectively suffers a negative real yield. The distinction between Nominal Returns and Real Returns is the single most critical concept in long-term finance.

            **Real Return = [(1 + Nominal Return) / (1 + Inflation Rate)] - 1**

            If you earn 7% nominally but inflation is 6%, your wealth has essentially grown by less than 1%. This mathematical reality makes 'safety' in fixed income a dangerous illusion for long-term goals.` 
        },
        { 
            heading: "II. Lifestyle Inflation vs. CPI", 
            body: `A profound error investors make is relying on the Consumer Price Index (CPI) as a personal benchmark. The CPI is a basket of goods including food and fuel. However, the consumption basket of an aspirational middle-class family is vastly different.

            Sectors such as healthcare, higher education, and premium real estate often inflate at rates double the official CPI (often 10-12% annually). This 'Personal Inflation Rate' is the true hurdle rate for your portfolio.` 
        }
      ],
      behavioralDimension: "The 'Money Illusion' cognitive bias leads individuals to view wealth in nominal terms. A salary hike of 5% feels like progress, even if inflation is 6%. This bias causes a systematic under-allocation to growth assets.",
      limitations: ["Inflation data is retrospective.", "Hedging against inflation introduces volatility risk."],
      riskStatement: "Attempting to outpace inflation requires exposure to assets with non-guaranteed outcomes.",
      source: "RBI Monetary Policy Reports."
    }
  },
  {
    id: 'asset-classes',
    title: 'Structural Asset Classes',
    subtitle: 'The Building Blocks of a Portfolio',
    icon: 'BookOpen',
    readTime: "35 min read",
    content: {
      openingContext: "Asset Allocation explains over 90% of the variance in portfolio returns. The goal is to construct a system where the whole is more robust than the sum of its parts. This module deconstructs the six fundamental asset classes available to the Indian investor.",
      visualType: 'assetClassExpandable',
      chapters: [
         { 
             heading: "I. Public Equity: The Engine of Wealth", 
             body: `**Definition:** Fractional ownership in a business.
             
             **Structural Role:** Equity serves a single purpose: **Real Growth**. It is the only major asset class that has historically produced returns significantly above inflation (5-6% Real Return) over multi-decade periods.` 
         },
         { 
             heading: "II. Fixed Income (Debt): The Stabilizing Anchor", 
             body: `**Definition:** Lending money to an entity (Government/Corporate).
             
             **Structural Role:** The purpose of Debt is **not** to make you rich. Its purpose is to keep you in the game. It acts as a shock absorber.` 
         },
         { 
             heading: "III. Gold: The Crisis Insurance", 
             body: `**Definition:** Unproductive commodity/monetary metal.
             
             **Structural Role:** Gold is **Insurance**, not an investment. It hedges against Currency Debasement and Extreme Geopolitical Stress. Since it produces no cash flow, allocation is capped at 5-10%.` 
         }
      ],
      behavioralDimension: "The 'Endowment Effect' causes investors to overvalue assets they already own and resist selling them to diversify.",
      limitations: ["Past correlation data may not hold in future crises.", "Taxation varies significantly."],
      riskStatement: "A perfectly diversified portfolio will always have one component that is underperforming.",
      source: "Modern Portfolio Theory (MPT)."
    }
  },
  {
    id: 'compounding',
    title: 'The Mechanics of Compounding',
    subtitle: 'Exponential Growth and Continuity',
    icon: 'Landmark',
    readTime: "12 min read",
    content: {
      openingContext: "Compounding is the mathematical manifestation of continuity. It is an exponential function where the primary variable is not the rate of return, but the duration of the holding period.",
      visualType: 'compounding',
      chapters: [
        { 
            heading: "I. Geometry of Wealth", 
            body: `The fundamental equation of compounding, **A = P(1 + r)^n**, reveals a non-intuitive truth: wealth accumulation is exponentially sensitive to *n* (time).` 
        }
      ],
      behavioralDimension: "Impatience is the behavioral manifestation of linear bias.",
      limitations: ["Assumes reinvestment of dividends.", "Sequence-of-returns risk."],
      riskStatement: "Compounding magnifies everything, including fees and inflation.",
      source: "Javier Estrada & Morgan Housel."
    }
  },
  {
    id: 'risk',
    title: 'Unified Risk Architecture',
    subtitle: 'A Taxonomy of Capital Destruction',
    icon: 'ShieldAlert',
    readTime: "45 min read",
    content: {
      openingContext: "We distinguish sharply between 'Volatility' (a temporary statistical characteristic) and 'Risk' (a permanent existential threat). The financial industry often conflates the two.",
      visualType: 'risk',
      chapters: [
         { 
             heading: "I. The Ontology of Risk vs. Volatility", 
             body: `Volatility is the price of admission. Risk is the permanent destruction of purchasing power.` 
         }
      ],
      behavioralDimension: "Recency Bias makes us extrapolate the immediate past into the infinite future.",
      limitations: ["Black Swans cannot be predicted, only endured."],
      riskStatement: "Survival is the only objective.",
      source: "Howard Marks & Nassim Taleb."
    }
  },
  {
    id: 'subtraction',
    title: 'The Art of Subtraction',
    subtitle: 'Via Negativa in Capital Allocation',
    icon: 'Divide',
    readTime: "18 min read",
    content: {
      openingContext: "In a financial ecosystem obsessed with 'Alpha', 'Outperformance', and 'More', the most powerful force available to the individual investor is Subtraction (Via Negativa). It is the recognition that improving outcomes is often easier achieved by removing stupidity than by seeking brilliance. Just as a sculpture is revealed by removing the stone that is not the statue, wealth is preserved by removing the behaviors, fees, and assets that destroy it. This module explores the mathematical and behavioral superiority of doing less.",
      visualType: 'dilemma',
      chapters: [
        {
          heading: "I. The Addition Bias",
          body: `Human beings are cognitively wired to solve problems by adding components. If a portfolio is underperforming, the instinct is to *add* a new fund, *add* a new strategy, or *add* a hedge. This 'Addition Bias' leads to fragility. In finance, every addition increases complexity, and complexity increases the probability of error.
          
          A portfolio with 20 mutual funds is not more diversified than a portfolio with 3; it is simply more expensive to maintain and harder to understand. The first step in the Art of Subtraction is to ask: "What can I remove from my portfolio that will leave the core compounding engine intact?" Often, the answer is: niche sector funds, complex insurance products, and tactical bets.`
        },
        {
          heading: "II. Subtracting Fees: The Deterministic Loss",
          body: `Fees are the only aspect of investing that is deterministic. Market returns are probabilistic; fees are guaranteed. 
          
          Consider two portfolios. Portfolio A generates 12% returns with a 2% expense ratio (typical active fund). Portfolio B generates 11% returns with a 0.1% expense ratio (index fund). Over 30 years, Portfolio B vastly outperforms Portfolio A, despite the lower gross return.
          
          Subtracting high-cost investment vehicles is the highest probability 'trade' you can make. It requires no market prediction, no timing, and no luck. By moving from Regular Plans to Direct Plans, and from Active Funds to Index Funds, you are mathematically subtracting the friction that grinds down capital.`
        },
        {
          heading: "III. Subtracting Activity: The Cost of Churn",
          body: `Activity is the enemy of returns. The more you look at your portfolio, the more likely you are to trade. The more you trade, the more you incur:
          1. **Transaction Costs:** Brokerage, STT, Stamp Duty.
          2. **Tax Friction:** Short Term Capital Gains (STCG) tax eats into the compounding base.
          3. **Behavioral Error:** Selling at the bottom and buying at the top.
          
          The Art of Subtraction demands the removal of the *access* to high-frequency data. Deleting trading apps from your phone and checking the portfolio only once a quarter is a subtraction of noise that leads to an addition of discipline. As Pascal noted, "All of humanity's problems stem from man's inability to sit quietly in a room alone."`
        },
        {
          heading: "IV. Subtracting the Need to be Smart",
          body: `Trying to be smart is expensive. Trying to beat the market requires you to compete with algorithmic supercomputers and institutional teams with information advantages. The probability of consistent victory is statistically negligible.
          
          By subtracting the ego-driven desire to 'beat' the market, you accept the market return (which, for the Nifty 50, has been ~12-14% historically). This acceptance allows you to focus on the variables you *can* control: your savings rate, your asset allocation, and your time horizon. You trade the low probability of being a genius for the high probability of being wealthy.`
        },
        {
          heading: "V. Subtracting Fragility (Leverage)",
          body: `Leverage (borrowing to invest) adds the potential for infinite ruin to a finite game. Even a great asset (like Real Estate or Bluechip Stocks) can destroy you if bought with leverage during a volatility cycle.
          
          If you have zero leverage, you can never be a forced seller. You can wait out any bear market, any recession, and any crisis. By subtracting leverage, you subtract the only mechanism that can take your capital to zero. The path to the Calm Capital is not about maximizing the speed of compounding, but ensuring the *continuity* of compounding.`
        }
      ],
      behavioralDimension: "The 'Action Bias' makes us feel that doing nothing is irresponsible. In finance, doing nothing (after setting a strategy) is the ultimate form of discipline.",
      limitations: ["Subtracting too much can lead to under-diversification.", "Requires immense psychological fortitude to be inactive."],
      riskStatement: "Simplicity does not eliminate risk; it merely makes risk visible and manageable.",
      source: "Nassim Taleb's 'Antifragile' & The concept of Via Negativa."
    }
  },
  {
    id: 'disclaimer',
    title: 'Legal Disclaimer',
    subtitle: 'Important Regulatory & Risk Disclosures',
    icon: 'ShieldAlert',
    readTime: "5 min read",
    content: {
      openingContext: "The Calm Capital is strictly an educational initiative.",
      chapters: [
        {
          heading: "1. No Investment Advice",
          body: `The content on this website is for informational purposes only. It does not constitute investment advice.`
        }
      ],
      behavioralDimension: "Acknowledging limits is the first step.",
      limitations: [],
      riskStatement: "You assume full responsibility for your decisions.",
      source: "Legal Counsel."
    }
  }
];
    </script>

    <!-- 2. Libraries -->
    <script>
      window.tailwind = {
        config: {
          theme: {
            extend: {
              fontFamily: {
                serif: ['"Playfair Display"', 'serif'],
                body: ['"Lora"', 'serif'],
                sans: ['"Inter"', 'sans-serif']
              },
              colors: {
                codex: {
                  black: '#0a0a0a',      
                  card: '#121212',       
                  border: '#2a2a2a',     
                  text: '#E5E5E5',       
                  dim: '#A1A1AA',        
                  gold: '#D4AF37',       
                  goldDim: '#8a7020',    
                  alert: '#7f1d1d'       
                }
              },
              animation: {
                'fade-in': 'fadeIn 0.5s ease-out',
                'fade-in-up': 'fadeInUp 0.8s ease-out',
              },
              keyframes: {
                fadeIn: {
                  '0%': { opacity: '0' },
                  '100%': { opacity: '1' },
                },
                fadeInUp: {
                  '0%': { opacity: '0', transform: 'translateY(10px)' },
                  '100%': { opacity: '1', transform: 'translateY(0)' },
                }
              }
            }
          }
        }
      }
    </script>
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
    
    <!-- 3. Main App Logic -->
    <script type="text/babel" data-type="module" defer>
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { motion, useScroll, useSpring, AnimatePresence } from 'framer-motion';
        import { 
          BookOpen, ShieldAlert, Scale, Landmark, ChevronRight, Menu, X, 
          Search, Book, User, Feather, FileText, Lock, Layers, Compass, Gavel, Clock, ArrowUp, Zap, BarChart, Activity, Droplets, Target,
          Globe, Home, TrendingUp, Coins, Divide
        } from 'lucide-react';

        const MODULES = window.CALM_CAPITAL_CONTENT || [];

        const IconMap = {
            Compass: Compass,
            Scale: Scale,
            BookOpen: BookOpen,
            Landmark: Landmark,
            ShieldAlert: ShieldAlert,
            Gavel: Gavel,
            Lock: Lock,
            User: User,
            Layers: Layers,
            Divide: Divide
        };

        /* --- VISUALIZATION COMPONENTS (Kept same as before) --- */
        const GrowthVsRealityDiagram = () => {
          return (
            <div className="w-full p-8 bg-codex-card border border-codex-gold rounded-sm mb-12 relative overflow-hidden group">
                <div className="absolute top-0 right-0 p-4 opacity-10 transition-opacity group-hover:opacity-20">
                    <Activity size={120} className="text-codex-gold" />
                </div>
                <h4 className="font-serif text-2xl text-codex-text mb-2">The Wealth Gap</h4>
                <div className="relative h-64 w-full flex items-end justify-between px-0 md:px-4 border-l border-b border-codex-gold">
                    <svg className="absolute inset-0 h-full w-full pointer-events-none overflow-visible" viewBox="0 0 100 100" preserveAspectRatio="none">
                        <motion.path d="M 0 100 C 30 80, 60 40, 100 10" fill="none" stroke="#D4AF37" strokeWidth="0.8" initial={{ pathLength: 0 }} whileInView={{ pathLength: 1 }} transition={{ duration: 2 }} />
                        <motion.path d="M 0 100 C 30 90, 60 80, 100 60" fill="none" stroke="#52525b" strokeWidth="0.8" strokeDasharray="2 2" initial={{ pathLength: 0 }} whileInView={{ pathLength: 1 }} transition={{ duration: 2, delay: 0.5 }} />
                    </svg>
                </div>
            </div>
          )
        };
        const InflationDiagram = () => <div className="p-8 bg-codex-card border border-codex-gold/20 text-center text-codex-dim">Inflation Visualization Placeholder</div>;
        const AssetClassTable = () => <div className="p-8 bg-codex-card border border-codex-gold/20 text-center text-codex-dim">Asset Table Placeholder</div>;
        const InteractiveAssetGrid = () => <div className="p-8 bg-codex-card border border-codex-gold/20 text-center text-codex-dim">Interactive Grid Placeholder</div>;
        const CompoundingDiagram = () => <div className="p-8 bg-codex-card border border-codex-gold/20 text-center text-codex-dim">Compounding Visualization Placeholder</div>;
        const InteractiveRiskMatrix = () => <div className="p-8 bg-codex-card border border-codex-gold/20 text-center text-codex-dim">Risk Matrix Placeholder</div>;

        const VisualComponent = ({ type }) => {
            switch(type) {
                case 'dilemma': return <GrowthVsRealityDiagram />;
                case 'inflation': return <InflationDiagram />;
                case 'assetClass': return <AssetClassTable />;
                case 'assetClassExpandable': return <InteractiveAssetGrid />;
                case 'compounding': return <CompoundingDiagram />;
                case 'risk': return <InteractiveRiskMatrix />;
                default: return null;
            }
        };

        /* --- NEW LANDING HUB COMPONENT --- */
        const LandingHub = ({ modules, onNavigate }) => {
            return (
                <div className="animate-fade-in-up">
                    <div className="mb-16 text-center md:text-left">
                        <div className="inline-block p-3 rounded-full border border-codex-gold mb-6">
                            <Compass size={32} className="text-codex-gold" />
                        </div>
                        <h1 className="font-serif text-5xl md:text-7xl text-codex-text leading-tight mb-6">The Calm<br/><span className="text-codex-gold">Capital</span></h1>
                        <p className="font-body text-xl md:text-2xl text-codex-dim italic font-light leading-relaxed max-w-2xl">
                            Institutional Wealth Preservation Strategy for the Patient Indian Investor.
                        </p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 asset-grid-container">
                        {modules.filter(m => m.id !== 'home' && m.id !== 'disclaimer' && m.id !== 'terms' && m.id !== 'privacy' && m.id !== 'about').map((mod, idx) => {
                            const Icon = IconMap[mod.icon] || Compass;
                            return (
                                <motion.button
                                    key={mod.id}
                                    whileHover={{ scale: 1.01, borderColor: '#D4AF37' }}
                                    whileTap={{ scale: 0.99 }}
                                    onClick={() => onNavigate(mod.id)}
                                    className="text-left p-8 bg-codex-card border border-codex-gold/30 rounded-sm relative group overflow-hidden transition-all duration-300"
                                >
                                    <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity transform group-hover:scale-110 duration-500">
                                        <Icon size={80} />
                                    </div>
                                    <div className="relative z-10">
                                        <div className="flex items-center gap-3 mb-4">
                                            <span className="text-xs font-bold tracking-[0.2em] text-codex-gold uppercase">Module {String(idx + 1).padStart(2, '0')}</span>
                                            <div className="h-px w-8 bg-codex-gold/50"></div>
                                        </div>
                                        <h3 className="font-serif text-2xl text-codex-text mb-2 group-hover:text-codex-gold transition-colors">{mod.title}</h3>
                                        <p className="font-sans text-xs text-codex-dim uppercase tracking-widest mb-6">{mod.subtitle}</p>
                                        <div className="flex items-center text-xs text-codex-gold font-bold uppercase tracking-wider">
                                            Read Module <ChevronRight size={14} className="ml-1 group-hover:translate-x-1 transition-transform" />
                                        </div>
                                    </div>
                                </motion.button>
                            )
                        })}
                    </div>
                </div>
            )
        };

        /* --- ARTICLE COMPONENT --- */
        const ArticleComponent = ({ module }) => (
            <article className="animate-fade-in-up">
                <div className="mb-12">
                    <div className="flex items-center gap-3 mb-4">
                    <span className="text-xs font-bold tracking-[0.2em] text-codex-gold uppercase">Module Reference</span>
                    <div className="h-px w-12 bg-codex-gold"></div>
                    </div>
                    <h1 className="font-serif text-4xl md:text-6xl text-codex-text leading-tight mb-6">{module.title}</h1>
                    <p className="font-body text-xl md:text-2xl text-codex-dim italic font-light leading-relaxed">{module.subtitle}</p>
                </div>

                <div className="font-serif text-lg md:text-xl text-codex-text leading-loose mb-16 opacity-90 border-l-2 border-codex-gold pl-6">
                    {module.content.openingContext}
                </div>

                {module.content.visualType && (
                    <figure className="my-16 animate-fade-in">
                        <VisualComponent type={module.content.visualType} />
                    </figure>
                )}

                <div className="my-16 space-y-20">
                    {module.content.chapters.map((chapter, idx) => (
                        <section key={idx} className="relative chapter-section">
                        <div className="h-px w-full bg-gradient-to-r from-transparent via-codex-gold to-transparent opacity-40 mb-12"></div>
                        <h3 className="font-sans text-lg font-bold uppercase tracking-widest text-codex-text mb-8 flex items-center gap-4">
                            <span className="w-8 h-8 rounded-full border border-codex-gold flex items-center justify-center text-xs text-codex-gold">{idx + 1}</span>
                            {chapter.heading}
                        </h3>
                        <div className="font-body text-lg md:text-xl text-codex-dim leading-loose space-y-6 text-justify">
                            {chapter.body ? chapter.body.split('\n\n').map((paragraph, i) => (
                            <p key={i}>{paragraph.trim()}</p>
                            )) : null}
                        </div>
                        </section>
                    ))}
                </div>

                {module.content.behavioralDimension && (
                    <div className="grid md:grid-cols-2 gap-12 mb-16 pt-12 border-t border-codex-gold/30 bg-codex-card/30 p-8 rounded-sm">
                        <div>
                            <h4 className="font-sans text-xs font-bold uppercase tracking-widest text-codex-gold mb-4 flex items-center gap-2"><User size={14}/> Behavioral Dimension</h4>
                            <p className="font-body text-base text-codex-text leading-relaxed">{module.content.behavioralDimension}</p>
                        </div>
                        <div>
                            <h4 className="font-sans text-xs font-bold uppercase tracking-widest text-codex-gold mb-4 flex items-center gap-2"><Layers size={14}/> Structural Limitations</h4>
                            <ul className="list-disc pl-5 space-y-3 marker:text-codex-gold text-codex-dim font-body text-base">
                                {module.content.limitations.map((limit, idx) => <li key={idx} className="pl-2">{limit}</li>)}
                            </ul>
                        </div>
                    </div>
                )}
            </article>
        );

        /* --- MAIN APP --- */
        const App = () => {
          const [activeModuleId, setActiveModuleId] = useState('home');
          const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
          const [scrolled, setScrolled] = useState(false);
          
          useEffect(() => {
            const handleHashChange = () => {
              const hash = window.location.hash.replace('#', '');
              if (hash && MODULES.some(m => m.id === hash)) {
                setActiveModuleId(hash);
              }
            };
            handleHashChange();
            window.addEventListener('hashchange', handleHashChange);
            return () => window.removeEventListener('hashchange', handleHashChange);
          }, []);

          useEffect(() => {
            let ticking = false;
            const handleScroll = () => {
              if (!ticking) {
                window.requestAnimationFrame(() => {
                  setScrolled(window.scrollY > 50);
                  ticking = false;
                });
                ticking = true;
              }
            };
            window.addEventListener('scroll', handleScroll, { passive: true });
            return () => window.removeEventListener('scroll', handleScroll);
          }, []);

          const handleModuleSelect = (id) => {
            window.location.hash = id;
            setActiveModuleId(id);
            window.scrollTo({ top: 0, behavior: 'instant' });
          };

          const activeModule = MODULES.find(m => m.id === activeModuleId) || MODULES[0];

          // SEO Title Update
          useEffect(() => {
             if (activeModule) {
                 document.title = activeModule.id === 'home' 
                    ? "The Calm Capital | Institutional Wealth Preservation" 
                    : `${activeModule.title} | The Calm Capital`;
             }
          }, [activeModule]);

          const ReadingProgress = () => {
              const { scrollYProgress } = useScroll();
              const scaleX = useSpring(scrollYProgress, { stiffness: 100, damping: 30, restDelta: 0.001 });
              return <motion.div className="fixed top-0 left-0 right-0 h-1 bg-codex-gold z-50 origin-left" style={{ scaleX }} />;
          };

          if (!activeModule) return null;

          return (
            <div className="min-h-screen text-codex-text selection:bg-codex-gold/30">
              <ReadingProgress />
              
              {/* Desktop Sidebar */}
              <nav className="hidden lg:flex flex-col w-80 h-screen fixed left-0 top-0 bg-codex-black border-r border-codex-gold z-20">
                <div className="p-8 border-b border-codex-gold">
                  <h2 className="font-serif text-3xl text-codex-text tracking-tight cursor-pointer" onClick={() => handleModuleSelect('home')}>
                    The Calm<br/><span className="text-codex-gold">Capital</span>
                  </h2>
                  <p className="text-[10px] text-codex-dim mt-4 font-sans uppercase tracking-[0.2em]">Institutional Archive</p>
                </div>
                <div className="flex-1 overflow-y-auto py-6 px-4 space-y-2">
                  {MODULES.map((module) => {
                    const ModuleIcon = IconMap[module.icon] || Compass;
                    return (
                    <button
                      key={module.id}
                      onClick={() => handleModuleSelect(module.id)}
                      className={`w-full text-left px-4 py-4 rounded-sm transition-all duration-300 group flex items-center gap-3 border border-transparent ${activeModuleId === module.id ? 'bg-codex-card border-codex-gold' : 'hover:bg-codex-card/50'}`}
                    >
                      <span className={`transition-colors ${activeModuleId === module.id ? 'text-codex-gold' : 'text-codex-dim'}`}>
                        <ModuleIcon className="w-5 h-5" />
                      </span>
                      <div className="flex flex-col">
                        <span className={`font-sans text-sm font-medium ${activeModuleId === module.id ? 'text-codex-text' : 'text-codex-dim'}`}>
                          {module.title}
                        </span>
                      </div>
                      {activeModuleId === module.id && <ChevronRight className="ml-auto w-4 h-4 text-codex-gold" />}
                    </button>
                  )})}
                </div>
              </nav>

              {/* Mobile Header */}
              <div className="lg:hidden fixed top-0 left-0 right-0 h-16 bg-[#0a0a0a] border-b border-codex-gold/50 z-50 flex items-center justify-between px-6 backdrop-blur-md bg-opacity-95 transform-gpu">
                 <span className="font-serif text-lg text-codex-text">The Calm Capital</span>
                 <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="p-2 text-codex-text">
                   {mobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
                 </button>
              </div>

              {/* Mobile Menu */}
              {mobileMenuOpen && (
                <div className="fixed inset-0 z-40 pt-20 px-6 animate-fade-in lg:hidden flex flex-col overflow-y-auto bg-codex-black border-t border-codex-gold" style={{ backgroundColor: '#0a0a0a' }}>
                   {MODULES.map((module) => (
                      <button
                        key={module.id}
                        onClick={() => { handleModuleSelect(module.id); setMobileMenuOpen(false); }}
                        className="text-left py-6 border-b border-codex-gold/30 text-xl font-serif text-codex-text flex items-center justify-between active:text-codex-gold"
                      >
                        {module.title}
                        <ChevronRight className="w-5 h-5 text-codex-gold/50" />
                      </button>
                   ))}
                </div>
              )}

              {/* Main Content */}
              <main className="lg:pl-80 pt-16 lg:pt-0 w-full transition-all duration-500">
                <div className="max-w-4xl mx-auto px-6 py-12 md:py-24">
                  {/* Header Meta (Hidden on Home) */}
                  {activeModule.layout !== 'hub' && (
                      <div className="mb-12 flex items-center justify-between opacity-50 border-b border-codex-gold/50 pb-4">
                        <div className="flex gap-4">
                            <div className="text-[10px] uppercase tracking-[0.2em] font-sans text-codex-dim flex items-center gap-1"><Clock size={10} /> {activeModule.readTime}</div>
                        </div>
                        <div className="text-[10px] uppercase tracking-[0.2em] font-sans text-right text-codex-dim">Ref: {activeModule.id.toUpperCase()}</div>
                      </div>
                  )}

                  {/* Render Hub or Article */}
                  {activeModule.layout === 'hub' ? (
                      <LandingHub modules={MODULES} onNavigate={handleModuleSelect} />
                  ) : (
                      <ArticleComponent module={activeModule} />
                  )}

                  <footer className="mt-32 text-center pb-20">
                    <div className="w-12 h-px bg-codex-gold mx-auto mb-8"></div>
                    <div className="flex justify-center gap-6 text-xs font-sans uppercase tracking-widest text-codex-dim">
                        <button onClick={() => handleModuleSelect('disclaimer')} className="hover:text-codex-gold transition-colors">Disclaimer</button>
                        <button onClick={() => handleModuleSelect('terms')} className="hover:text-codex-gold transition-colors">Terms of Service</button>
                    </div>
                  </footer>
                </div>
              </main>

              {scrolled && (
                <button 
                  onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
                  className="fixed bottom-8 right-8 p-3 bg-codex-gold text-codex-black rounded-full shadow-lg hover:bg-white transition-colors z-50 animate-fade-in transform-gpu"
                >
                  <ArrowUp size={20} />
                </button>
              )}
            </div>
          );
        };

        const init = () => {
             const root = createRoot(document.getElementById('root'));
             root.render(<App />);
        };
        if ('requestIdleCallback' in window) { requestIdleCallback(init); } else { setTimeout(init, 100); }
    </script>
</body>
</html>
